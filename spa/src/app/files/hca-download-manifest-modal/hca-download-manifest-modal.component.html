<div class="hca-download" *ngIf="state$ | async as state">
    <ng-container *ngIf="isDownloadNotStarted(state.manifestResponse)">
        <div>
            <span>Select Manifest File Types</span>
            <span class="fontsize-s">A file manifest contains a list of data files matching your search criteria along with a subset of the metadata.</span>
            <span class="fontsize-s">Once you have obtained your manifest, you may use it in conjunction with the HCA CLI, to download your selected data and associated metadata.</span>
        </div>
        <ng-container [ngSwitch]="isFileTypeSummariesEmpty(state.fileManifestFileSummary)">
            <div *ngSwitchCase="true" class="hca-spinner">
                <mat-spinner diameter="28"></mat-spinner>
            </div>
            <ng-container *ngSwitchDefault>
                <hca-file-summary
                        [showDownload]="false"
                        [summary]="state.fileManifestFileSummary"></hca-file-summary>
                <div class="separator"></div>
                <hca-file-filter-result [selectedSearchTerms]="state.selectedSearchTerms"
                                        [removable]="false"></hca-file-filter-result>
                <div class="separator"></div>
                <div class="hca-download-content">
                    <div class="facet-term-list">
                        <file-type-summary-list [selectedSearchTermNames]="state.selectedSearchTermNames"
                                                [fileTypeSummaries]="getFileTypeSummaries(state.fileManifestFileSummary)"
                                                (facetTermSelected)="onFacetTermSelected($event)"></file-type-summary-list>
                    </div>
                </div>
                <div class="hca-download-action">
                    <button type="button" (click)="onRequestManifest()">Prepare File Manifest</button>
                </div>
            </ng-container>
        </ng-container>
    </ng-container>
    <ng-container *ngIf="isDownloadInProgress(state.manifestResponse)">
        <div>
            <span>Your File Manifest is Being Prepared</span>
        </div>
        <div class="hca-download-content">
            <p class="fontsize-s">When your manifest is ready, you may download it or copy the manifest link to your clipboard.</p>
        </div>
        <div class="hca-download-action">
            <mat-spinner diameter="28"></mat-spinner>
        </div>
    </ng-container>
    <ng-container *ngIf="isDownloadComplete(state.manifestResponse)">
        <div>
            <span>Your File Manifest is Ready</span>
        </div>
        <div class="hca-download-content">
            <p class="fontsize-s">Next, use the HCA CLI to download the files listed in your manifest and their associated metadata.</p>
            <p class="fontsize-s">
                <a target="_blank"
                   href="{{portalURL}}/guides#downloading-a-data-manifest"
                   (click)="closeDialog()">View HCA CLI Instructions</a>
            </p>
        </div>
        <div class="hca-download-action">
            <button type="button" (click)="onDownloadManifest(state.manifestResponse)">Download Manifest</button>
            <button type="button"
                    ngxClipboard
                    [cbContent]="(state.manifestResponse.fileUrl)"
                    class="hca-outline-button">
                <img src="assets/images/icon/hca-copy.png"/><span>Copy Link to Clipboard</span></button>
        </div>
    </ng-container>
</div>
