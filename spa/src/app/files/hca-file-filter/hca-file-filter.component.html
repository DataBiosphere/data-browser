<div class="wrapper">
    <div id="filter" [ngClass]="{'filter': true, 'small': (isDeviceMobile() || isWindowWidthSmall())}">
        <input class="hca-input" type="text" placeholder="Search" aria-label="Number" matInput
               [formControl]="filterControl" #filterInput [matAutocomplete]="auto" (click)="onHCASelectClose()">
        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onTermSelected($event)"
                          [displayWith]="displayFn">
            <mat-option *ngIf="searchReturnsEmpty" class="hca-option error">Oops! We donâ€™t have an exact match, it may
                be called by a different name. Scroll through the list to see what data we currently have available.
            </mat-option>
            <mat-optgroup class="hca-optgroup" *ngFor="let facet of filteredFacets$ | async"
                          [label]="facet.displayName"
                          [disabled]="facet.disabled">
                <mat-option class="hca-option" *ngFor="let term of facet.terms" [value]="{facet:facet, term:term}">
                    <span [ngClass]="getTruncatedClass(term.termName)">{{term.termName}}</span>
                    <span>{{term.count | countSize}}</span>
                </mat-option>
            </mat-optgroup>
        </mat-autocomplete>
        <ng-container [ngSwitch]="isDeviceMobile() || isWindowWidthSmall()">
            <div id="select" class="view-all-options" *ngSwitchDefault>
                <ng-container *ngFor="let facetGroup of facetGroups; let i = index;trackBy: trackFacetGroupByFn">
                    <div [ngClass]="getSelectClass(i)" (click)="onHCASelect(i)">
                        <span>{{facetGroup.facetGroupName}}</span>
                        <mat-icon>keyboard_arrow_down</mat-icon>
                        <ng-container *ngIf="fileFacets.length && selectIndex === i">
                            <div id="options" [ngClass]="getOptionsClass(i)" [ngStyle]="getFacetStyles(i, facetGroup.facetNames.length, facetGroups.length)" (mouseleave)="onHCASelectClose()">
                                <hca-file-facet [fileFacet]="getFacet(facetName)" 
                                                *ngFor="let facetName of facetGroup.facetNames;trackBy: trackFileFacetByFn"></hca-file-facet>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
            </div>
            <ng-container *ngSwitchCase="true">
                <div class="view-options" [ngClass]="getSelectClass(1)" (click)="onHCASelect(1)">
                    <span>Filter</span>
                    <mat-icon>keyboard_arrow_down</mat-icon>
                </div>
                <div [ngClass]="getOptionsSmallClass()">
                    <div>
                        <ng-container *ngFor="let facetGroup of facetGroups; let f = index">
                            <div class="facet-group">{{facetGroup.facetGroupName}}</div>
                            <ng-container *ngIf="fileFacets.length">
                                <div [ngClass]="getIsOpenClass(f, t)"
                                     *ngFor="let facetName of facetGroup.facetNames; let t = index">
                                    <div class="facet" (click)="onHCAFacetSelect(f, t)">
                                        <span>{{facetName}}</span>
                                        <mat-icon>keyboard_arrow_down</mat-icon>
                                    </div>
                                    <div class="facet-term-list">
                                        <hca-facet-term-list [fileFacet]="getFacet(facetName)"
                                                             (facetTermSelected)="onFacetTermSelected($event)"></hca-facet-term-list>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                        <div class="apply">
                            <button (click)="onHCASelectClose()">Apply</button>
                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-container>
    </div>
</div>
<div *ngIf="selectIndex != null" class="hca-select-overlay" (click)="onHCASelectClose()"></div>
